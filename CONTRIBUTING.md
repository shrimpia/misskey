# コントリビューション ガイドライン
Ebisskey へのコントリビューションをお考えいただき、ありがとうございます。
このドキュメントは、Ebisskeyの開発に関する取り決めごとを含みます。

IssueやPull Requestを作成する前に、必ずこのガイドラインをお読みください。

> [!NOTE]
> このプロジェクトは、日本語を公用語としています。IssueやPRは日本語で作成してください。

## メンテナー
本プロジェクトに関わる全ての権限は、Shrimpia Networkの @EbiseLutica が保有します。

開発上の方針は全て、メンテナーによる意思の下、定められます。

## Issues
Issueを作成する前に、同様・あるいは似たようなissueがないかどうか検索するよう心がけてください。

## Pull Requests
Pull Requestを作成される場合、必ず以下の方針に従ってください。

### 先に、Issueを立てて話し合うこと
機能追加や不具合の修正対応を行う場合、まずはIssueを立て、仕様に対するメンテナーとの合意を確約してください。

具体的には、自身がIssueを立てる場合は、どのように考えているかを概要に記し、メンテナーのOKサインが出てから着手してください。この過程までに、いくつかの質問や相談をする場合があります。議論が長い事白熱する場合は、メンテナーの権限により、仕様が決定される場合があります。

また、メンテナーが作成したIssueに着手する場合、曖昧な点は質問するようにしてください。メンテナーの方針と異なるPRが作成された場合、コードレビューが長引くかもしれません。

上記のプロセスを経ずに作成されたPRは、全てリジェクトされます。

### 着手時は、Issueに自身をアサインすること
Issueの内容が確定した場合、着手時にそのIssueに自身をアサインしてください。

## 使用しているブランチ
- **`master`** ブランチ: リリース用の安定ブランチ。
- **`develop`** ブランチ: 開発中のブランチ。
	- 開発中の機能は、シュリンピア帝国に関わらないものであればこちらへPRしてください。
- **`empire`** ブランチ: シュリンピア帝国で用いているブランチ。
	- シュリンピア独自機能に関するIssueのPRはこちらへ

## 方針

### 1. misskey-dev/misskey（以後、本家とする）への追従を優先すること
Ebisskeyは、常に本家に追従することを方針としています。

本家に適用されたコードが既存の独自機能と衝突する場合、独自機能を削除してでもマージします。その後、再実装するよう努めますが、場合によっては廃止となることがあります。

### 2. 本家のテーブルやカスタム型などを編集しないこと
本家が追加したテーブルやEnumなどに対し、独自のカラム等を追加しないでください。

Ebisskeyは、いつでも同等バージョンの本家Misskeyに戻せるように設計しています。

### 3. 独自の改変箇所は、なるべくコメントで明確にすること
独自に改変したTypeScriptコードには、なるべく以下のようなコメントを追加してください。
```ts
// #region Ebisskey
...
// #endregion
```

場合によっては、変更箇所を明記します。

```ts
// #region Ebisskey デフォルト値をfalseからtrueに
shrimpIsTasty: true;
// #endregion
```

## 考え方
### DRYに囚われるな
必要なのは一般化ではなく抽象化と考えます。
盲信せず、誤った・不必要な共通化は避け、それが自然だと感じる場合は重複させる勇気を持ちましょう。

### Misskeyを複雑にしない実装
それがいくら複雑であっても、Misskey固有のコンテキストと関心が分離されている(もしくは事実上分離されていると見做すことができる)実装であれば、それはMisskeyのコードベースに対する複雑性に影響を与えないと考えます。

例えるなら、VueやAiScriptといったMisskeyが使用しているライブラリの内部実装がいくら複雑だったとしても、「それを使用しているからMisskeyの実装は複雑である」ということにはならないのと同じです。

Misskeyのドメイン知識から関心が分離されているということは、Misskeyの実装について考える時にそれらの内部実装を考慮する必要が無く、認知負荷を増やさないからです。

また重要な点は、その実装が、Misskeyリポジトリの外部にあるか・内部にあるかということや、Misskeyがメンテナンスするものか・第三者がメンテナンスするものかといったことは複雑性を考える上ではほとんど無視できるという点です。

もちろんその実装がMisskeyリポジトリにあり、Misskeyがメンテナンスしなければならないものは、保守のコストはかかります。
しかし、Misskeyの本質的な設計・実装という観点で見たときは、その実装は実質的に外部ライブラリのように振る舞います。
換言すれば「たまたまMisskeyの開発者と同じ人たちがメンテナンスしているし、たまたまMisskeyのリポジトリ内に置いてあるだけの外部ライブラリ」です。

そのため、実装をなるべくMisskeyのドメイン知識から独立したものにすれば、Misskeyのコードベースの複雑性を上げることなく機能実装を行うことができ、お得であると言えます。
もちろんそれにこだわって、些細な実装でもそのように分離してしまうとかえって認知負荷が増えたり、実装量が増えてメリットをデメリットが上回る場合もあるので、ケースバイケースではあります。
